<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
        <script src="ezCmp.js"></script>
        <style>
            .green {
                background-color: green;
            }
            .whiteText {
                color: white;
            }
        </style>
    </head>
    <body></body>
    <script>
        new ezCmp({
            mount: 'body',
            components: ['cmp2'],
            name: 'main',
            state: {
                curTodo: '',
                todos: [
                    { text: 'eat', state: 'checked', show: false },
                    { text: 'work', state: '' },
                    { text: 'sleep', state: '' }
                ]
            },
            storage: ['todos'],
            computed: {
                todoCount() {
                    return this.state.todos.length
                },
                is5() {
                    return this.state.todos.length == 5
                }
            },
            watch: {
                todos: (newval) => newval.length <= 5
            },
            methods: {
                setCurTodo(e) {
                    this.state.curTodo = e.target.value
                },
                addTodo() {
                    if (this.state.curTodo != '') {
                        this.state.todos = [
                            ...this.state.todos,
                            { text: this.state.curTodo, checked: '' }
                        ]
                        this.state.curTodo = ''
                    }
                },
                pressTodo(e) {
                    if (e.keyCode == 13) {
                        this.addTodo()
                    }
                },
                setChecked(e, i) {
                    let val = e.target.checked
                    this.state.todos[i].state = val ? 'checked' : ''
                    this.state.todos = this.state.todos
                },
                removeTodo(i) {
                    this.state.todos.splice(i, 1)
                    this.state.todos = this.state.todos
                }
            },
            classes: {
                checked: {
                    textDecoration: 'line-through'
                },
                blue: {
                    color: 'blue',
                    fontSize: '60px'
                }
            },
            render: `        
            <div id="cmp2"></div>
            <h1 class="blue">Todo EZCMP</h1>
            <input value="{curTodo}" oninput="setCurTodo(event)" onkeyup="pressTodo(event)" />
            <button onclick="addTodo()" class="!green !whiteText">Add Todo</button><br>
            {todoCount} todos
            <ul>
                <loop todos_todo_i>
                    <li class="{todo.state}">
                        {todo.text}
                        <input type="checkbox" {todo.state} onchange="setChecked(event,{i})">
                        <button onclick="removeTodo({i})">X</button>
                    </li>
                </loop>
            </ul>
            <if is5>
                Todos full!
            </if>
        `
        })
        new ezCmp({
            mount: '#cmp2',
            name: 'cmp2',
            state: {
                value: 'lol'
            },
            storage: ['value'],
            methods: {
                setValue() {
                    this.state.value = 'lmao'
                }
            },
            classes: {
                blue: {
                    color: 'red'
                }
            },
            render: `
                <h1 class="blue">Hello Cmp2! {value}</h1> 
                <button onclick="setValue()">set value</button>
            `
        })
    </script>
</html>
