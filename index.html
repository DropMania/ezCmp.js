<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>EZ CMP IS GREAT!</title>
        <script src="ezCmp.js"></script>
    </head>
    <body>
    </body>
    <script>
        new ezCmp({
            mount: 'body',
            components: ['cmp2'],
            state: {
                searchString: '',
                images: [],
                loading: false,
            },
            computed: {
                imageCount(){
                    return this.state.images.length;
                }
            },
            methods: {
                setSearchString(e) {
                    this.state.searchString = e.target.value;
                },
                async search(e) {
                    e.preventDefault();
                    this.state.loading = true;
                    let res = await fetch(`https://nature-image-api.vercel.app/search?q=${this.state.searchString}`)
                    let data = await res.json();
                    this.state.images = data.images;
                    this.state.loading = false;
                }
            },
            render: `
                <div id="comp2" loading="{loading}"></div>
                <h3>Image Search</h3>
                <form onsubmit="search(event)">
                <input placeholder="Search for an image" value="{searchString}" oninput="setSearchString(event)"/>
                <br>
                <if loading>
                    Loading...
                </if>
                <if !loading>
                    {imageCount} images found
                    <div class="images">
                        <loop images_image>
                            <div>
                                <img src="{image.image}" width="50px"/>
                                {image.title}
                            </div>
                        </loop>
                    </div>
                </if>
            `
        })
        new ezCmp({
            mount: '#comp2',
            name: 'cmp2',
            state: {
                name: 'test'
            },
            methods: {
                changeName(){
                    this.state.name = 'bernd'
                }
            },
            render: `halo {name} {props.loading} <button onclick="changeName()">change</button>`
        })
    </script>
</html>